import"/node_modules/core-js/modules/es.array.concat.js";import"/node_modules/core-js/modules/es.array.filter.js";import"/node_modules/core-js/modules/es.array.find.js";import"/node_modules/core-js/modules/es.array.find-index.js";import"/node_modules/core-js/modules/es.array.map.js";import"/node_modules/core-js/modules/es.object.to-string.js";import"/node_modules/core-js/modules/es.promise.js";import"/node_modules/regenerator-runtime/runtime.js";function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}var gen=fn.apply(self,args);_next(void 0)})}}import React,{useState,useEffect,useRef}from"c:\\node_modules\\react\\index.js";const _ref3=document.createElement("link");_ref3.rel="stylesheet",_ref3.href="/components/BlogDetails/CommentSection.module.css",document.head.appendChild(_ref3);const styles={};import{useDispatch}from"c:\\node_modules\\react-redux\\es\\index.js";import{commentPost}from"/actions/post.js";import DeleteIcon from"/node_modules/@material-ui/icons/Delete.js";import Button from"c:\\node_modules\\@material-ui\\core\\esm\\Button\\index.js";import{deleteComment,updateComment}from"/actions/post.js";import EditIcon from"/node_modules/@material-ui/icons/Edit.js";import{styled}from"c:\\node_modules\\@mui\\material\\styles\\index.js";var BootstrapButton=styled(Button)({color:"#454444",padding:"0",marginTop:"0.5em",marginRight:"0.5em",fontSize:"0.5em"}),CommentSection=function CommentSection(_ref){var post=_ref.post,dispatch=useDispatch();useRef();var _useState=useState(null==post?void 0:post.comments),comments=_useState[0],setComments=_useState[1],_useState2=useState(""),comment=_useState2[0],setComment=_useState2[1],_useState3=useState(null),commentId=_useState3[0],setCommentId=_useState3[1],_useState4=useState(JSON.parse(localStorage.getItem("profile"))),user=_useState4[0],setUser=_useState4[1];console.log(user.result.email);var toUpdateComment=comments.find(function(message){return message._id===commentId});console.log(toUpdateComment),console.log(commentId),console.log(toUpdateComment),useEffect(function(){toUpdateComment&&setComment(toUpdateComment.comment)},[toUpdateComment]),console.log(comment),console.log(comments);var handleComment=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var arrived,objIndex,newComments;return regeneratorRuntime.wrap(function _callee$(_context){for(;1;)switch(_context.prev=_context.next){case 0:if(null!==commentId){_context.next=10;break}return _context.next=3,dispatch(commentPost(post._id,{body:comment}));case 3:arrived=_context.sent,console.log(arrived),setComment(""),setComment(""),setComments(arrived),_context.next=18;break;case 10:return _context.next=12,dispatch(updateComment(post._id,commentId,{body:comment}));case 12:objIndex=comments.findIndex(function(obj){return obj._id===(null==toUpdateComment?void 0:toUpdateComment._id)}),console.log(objIndex),comments[objIndex].comment=comment,newComments=[].concat(comments),setComments(newComments),setComment("");case 18:case"end":return _context.stop();}},_callee)}));return function handleComment(){return _ref2.apply(this,arguments)}}();return console.log(comments),React.createElement("div",null,React.createElement("div",{className:styles.comment},React.createElement("h3",{style:{fontSize:"1.3em",color:"#454444"}},"Add Comment"),React.createElement("textarea",{className:styles.commentBox,multiline:!0,value:comment,onChange:function onChange(e){return setComment(e.target.value)}}),React.createElement("button",{className:styles.commentButton,onClick:handleComment},"Comment"),React.createElement("h3",null,"Comments"),comments.map(function(singleComment){return React.createElement("div",{key:singleComment._id,style:{width:"94vw"}},React.createElement("p",{style:{fontSize:"1em",marginTop:"1em",marginBottom:"0.5em",color:"#DEBA3B",fontWeight:"bold",width:"100%"}},singleComment.fromUser.username),React.createElement("div",{style:{background:"#DEBA3B",padding:"0.5em",borderRadius:"5px",width:"96vw",display:"flex",flexDirection:"row"}},React.createElement("p",{style:{width:"90%",wordWrap:"break-word"}},singleComment.comment),React.createElement("div",{style:{display:"flex",flexDirection:"row"}},user.result.email===singleComment.fromUser.email?React.createElement(BootstrapButton,{size:"small",color:"secondary",className:styles.deleteBox,onClick:_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var newComment;return regeneratorRuntime.wrap(function _callee2$(_context3){for(;1;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,dispatch(deleteComment(post._id,singleComment._id));case 2:newComment=comments.filter(function(comment){return comment._id!==singleComment._id}),console.log(newComment),setComments(newComment);case 5:case"end":return _context3.stop();}},_callee2)}))},React.createElement(DeleteIcon,{fontSize:"small"})," \xA0 Delete"):null,user.result.email===singleComment.fromUser.email?React.createElement(BootstrapButton,{size:"small",color:"secondary",className:styles.deleteBox,onClick:function onClick(){setCommentId(singleComment._id)}},React.createElement(EditIcon,{fontSize:"small",className:styles.deleteIcon})," ","\xA0 Edit"):null)))})))};export default CommentSection;