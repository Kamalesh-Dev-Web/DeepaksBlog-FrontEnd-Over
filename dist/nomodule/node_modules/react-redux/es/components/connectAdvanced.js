import"/node_modules/core-js/modules/es.function.name.js";import _extends from"/node_modules/@babel/runtime/helpers/esm/extends.js";import _objectWithoutPropertiesLoose from"/node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js";import hoistStatics from"c:\\node_modules\\hoist-non-react-statics\\dist\\hoist-non-react-statics.cjs.js";import React,{useContext,useMemo,useRef,useReducer}from"c:\\node_modules\\react\\index.js";import{isValidElementType,isContextConsumer}from"c:\\node_modules\\react-is\\index.js";import Subscription from"/node_modules/react-redux/es/utils/Subscription.js";import{useIsomorphicLayoutEffect}from"/node_modules/react-redux/es/utils/useIsomorphicLayoutEffect.js";import{ReactReduxContext}from"/node_modules/react-redux/es/components/Context.js";var EMPTY_ARRAY=[],NO_SUBSCRIPTION_ARRAY=[null,null],stringifyComponent=function stringifyComponent(Comp){try{return JSON.stringify(Comp)}catch(err){return Comp+""}};function storeStateUpdatesReducer(state,action){var updateCount=state[1];return[action.payload,updateCount+1]}function useIsomorphicLayoutEffectWithArgs(effectFunc,effectArgs,dependencies){useIsomorphicLayoutEffect(function(){return effectFunc.apply(void 0,effectArgs)},dependencies)}function captureWrapperProps(lastWrapperProps,lastChildProps,renderIsScheduled,wrapperProps,actualChildProps,childPropsFromStoreUpdate,notifyNestedSubs){lastWrapperProps.current=wrapperProps,lastChildProps.current=actualChildProps,renderIsScheduled.current=!1,childPropsFromStoreUpdate.current&&(childPropsFromStoreUpdate.current=null,notifyNestedSubs())}function subscribeUpdates(shouldHandleStateChanges,store,subscription,childPropsSelector,lastWrapperProps,lastChildProps,renderIsScheduled,childPropsFromStoreUpdate,notifyNestedSubs,forceComponentUpdateDispatch){if(shouldHandleStateChanges){var didUnsubscribe=!1,lastThrownError=null,checkForUpdates=function checkForUpdates(){if(!didUnsubscribe){var newChildProps,error,latestStoreState=store.getState();try{newChildProps=childPropsSelector(latestStoreState,lastWrapperProps.current)}catch(e){error=e,lastThrownError=e}error||(lastThrownError=null),newChildProps===lastChildProps.current?!renderIsScheduled.current&&notifyNestedSubs():(lastChildProps.current=newChildProps,childPropsFromStoreUpdate.current=newChildProps,renderIsScheduled.current=!0,forceComponentUpdateDispatch({type:"STORE_UPDATED",payload:{error:error}}))}};subscription.onStateChange=checkForUpdates,subscription.trySubscribe(),checkForUpdates();var unsubscribeWrapper=function unsubscribeWrapper(){if(didUnsubscribe=!0,subscription.tryUnsubscribe(),subscription.onStateChange=null,lastThrownError)throw lastThrownError};return unsubscribeWrapper}}var initStateUpdates=function initStateUpdates(){return[null,0]};export default function connectAdvanced(selectorFactory,_ref){void 0===_ref&&(_ref={});var _ref2=_ref,_ref2$getDisplayName=_ref2.getDisplayName,getDisplayName=void 0===_ref2$getDisplayName?function(name){return"ConnectAdvanced("+name+")"}:_ref2$getDisplayName,_ref2$methodName=_ref2.methodName,methodName=void 0===_ref2$methodName?"connectAdvanced":_ref2$methodName,_ref2$renderCountProp=_ref2.renderCountProp,renderCountProp=void 0===_ref2$renderCountProp?void 0:_ref2$renderCountProp,_ref2$shouldHandleSta=_ref2.shouldHandleStateChanges,shouldHandleStateChanges=!(void 0!==_ref2$shouldHandleSta)||_ref2$shouldHandleSta,_ref2$storeKey=_ref2.storeKey,storeKey=void 0===_ref2$storeKey?"store":_ref2$storeKey,_ref2$withRef=_ref2.withRef,withRef=void 0!==_ref2$withRef&&_ref2$withRef,_ref2$forwardRef=_ref2.forwardRef,forwardRef=void 0!==_ref2$forwardRef&&_ref2$forwardRef,_ref2$context=_ref2.context,context=void 0===_ref2$context?ReactReduxContext:_ref2$context,connectOptions=_objectWithoutPropertiesLoose(_ref2,["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"]),Context=context;return function wrapWithConnect(WrappedComponent){function createChildSelector(store){return selectorFactory(store.dispatch,selectorFactoryOptions)}function ConnectFunction(props){var _useMemo=useMemo(function(){var reactReduxForwardedRef=props.reactReduxForwardedRef,wrapperProps=_objectWithoutPropertiesLoose(props,["reactReduxForwardedRef"]);return[props.context,reactReduxForwardedRef,wrapperProps]},[props]),propsContext=_useMemo[0],reactReduxForwardedRef=_useMemo[1],wrapperProps=_useMemo[2],ContextToUse=useMemo(function(){return propsContext&&propsContext.Consumer&&isContextConsumer(React.createElement(propsContext.Consumer,null))?propsContext:Context},[propsContext,Context]),contextValue=useContext(ContextToUse),didStoreComeFromProps=!!props.store&&!!props.store.getState&&!!props.store.dispatch;!contextValue||contextValue.store;var store=didStoreComeFromProps?props.store:contextValue.store,childPropsSelector=useMemo(function(){return createChildSelector(store)},[store]),_useMemo2=useMemo(function(){if(!shouldHandleStateChanges)return NO_SUBSCRIPTION_ARRAY;var subscription=new Subscription(store,didStoreComeFromProps?null:contextValue.subscription),notifyNestedSubs=subscription.notifyNestedSubs.bind(subscription);return[subscription,notifyNestedSubs]},[store,didStoreComeFromProps,contextValue]),subscription=_useMemo2[0],notifyNestedSubs=_useMemo2[1],overriddenContextValue=useMemo(function(){return didStoreComeFromProps?contextValue:_extends({},contextValue,{subscription:subscription})},[didStoreComeFromProps,contextValue,subscription]),_useReducer=useReducer(storeStateUpdatesReducer,EMPTY_ARRAY,initStateUpdates),_useReducer$=_useReducer[0],previousStateUpdateResult=_useReducer$[0],forceComponentUpdateDispatch=_useReducer[1];if(previousStateUpdateResult&&previousStateUpdateResult.error)throw previousStateUpdateResult.error;var lastChildProps=useRef(),lastWrapperProps=useRef(wrapperProps),childPropsFromStoreUpdate=useRef(),renderIsScheduled=useRef(!1),actualChildProps=usePureOnlyMemo(function(){return childPropsFromStoreUpdate.current&&wrapperProps===lastWrapperProps.current?childPropsFromStoreUpdate.current:childPropsSelector(store.getState(),wrapperProps)},[store,previousStateUpdateResult,wrapperProps]);useIsomorphicLayoutEffectWithArgs(captureWrapperProps,[lastWrapperProps,lastChildProps,renderIsScheduled,wrapperProps,actualChildProps,childPropsFromStoreUpdate,notifyNestedSubs]),useIsomorphicLayoutEffectWithArgs(subscribeUpdates,[shouldHandleStateChanges,store,subscription,childPropsSelector,lastWrapperProps,lastChildProps,renderIsScheduled,childPropsFromStoreUpdate,notifyNestedSubs,forceComponentUpdateDispatch],[store,subscription,childPropsSelector]);var renderedWrappedComponent=useMemo(function(){return React.createElement(WrappedComponent,_extends({},actualChildProps,{ref:reactReduxForwardedRef}))},[reactReduxForwardedRef,WrappedComponent,actualChildProps]),renderedChild=useMemo(function(){return shouldHandleStateChanges?React.createElement(ContextToUse.Provider,{value:overriddenContextValue},renderedWrappedComponent):renderedWrappedComponent},[ContextToUse,renderedWrappedComponent,overriddenContextValue]);return renderedChild}var wrappedComponentName=WrappedComponent.displayName||WrappedComponent.name||"Component",displayName=getDisplayName(wrappedComponentName),selectorFactoryOptions=_extends({},connectOptions,{getDisplayName:getDisplayName,methodName:methodName,renderCountProp:renderCountProp,shouldHandleStateChanges:shouldHandleStateChanges,storeKey:storeKey,displayName:displayName,wrappedComponentName:wrappedComponentName,WrappedComponent:WrappedComponent}),pure=connectOptions.pure,usePureOnlyMemo=pure?useMemo:function(callback){return callback()},Connect=pure?React.memo(ConnectFunction):ConnectFunction;if(Connect.WrappedComponent=WrappedComponent,Connect.displayName=ConnectFunction.displayName=displayName,forwardRef){var forwarded=React.forwardRef(function forwardConnectRef(props,ref){return React.createElement(Connect,_extends({},props,{reactReduxForwardedRef:ref}))});return forwarded.displayName=displayName,forwarded.WrappedComponent=WrappedComponent,hoistStatics(forwarded,WrappedComponent)}return hoistStatics(Connect,WrappedComponent)}}